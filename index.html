
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>C√îNG C·ª§ GHI CH√âP NG√ÄY GI·ªú ƒêI L√ÄM</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Text:wght@400;700&display=swap');
        
        body {margin:0;padding:0;font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;background: linear-gradient(135deg,#f0f0f5 0%,#d9d9d9 100%);display:flex;justify-content:center;align-items:flex-start;padding:20px;-webkit-font-smoothing:antialiased; transition: background 0.3s;}
        body.dark { background: #1a1a1a; color: #eee; }
        
        #app {background: rgba(255 255 255 / 0.85);backdrop-filter: saturate(180%) blur(20px);border-radius: 20px;box-shadow: 0 8px 32px 0 rgba(0,0,0,0.12);padding:40px 28px 28px 28px;max-width:420px;width:100%;color:#142a51;box-sizing:border-box; position: relative;}
        body.dark #app { background: rgba(40, 40, 40, 0.95); color: #fff; }
        
        #themeToggle { position: absolute; top: 15px; right: 15px; border: none; background: rgba(0,0,0,0.05); width: 35px; height: 35px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        body.dark #themeToggle { background: rgba(255,255,255,0.1); }
        
        h1 {margin:0 0 10px 0;font-weight:700;font-size:1.4rem;text-align:center; text-transform: uppercase;}
        .field {margin-bottom:12px;}
        label {display:block;margin-bottom:4px;font-weight:600;font-size:0.85rem;}
        
        input[type="text"], input[type="date"], input[type="number"], select {width:100%;padding:10px 14px;font-size:1rem;border:1px solid #ddd;border-radius:12px;background: #fff;box-sizing:border-box; outline: none;}
        body.dark input, body.dark select { background: #333; color: #fff; border-color: #444; }
        
        #calam { color: #008000; font-weight: 700; border: 2px solid #008000; }
        body.dark #calam { color: #00ff00; border-color: #00ff00; }

        input:focus { border-color: #4cd964; }
        
        .time-group {display:flex;gap:8px;}
        .time-group > div {flex:1;}
        
        button {cursor:pointer;font-weight:700;font-size:1rem;border:none;border-radius:12px;padding:12px 0;width:48%; transition: 0.3s;}
        #btn-save {background-color:#4cd964;color:white;}
        #btn-reset {background-color:#ff3b30;color:white;}
        #btn-show-history {background-color:#fff;color:#142a51;border-radius:16px;padding:12px 0;width:100%;margin-top:12px;font-weight:700;box-shadow:0 2px 8px rgb(0 0 0 / 0.12); border: 1px solid #ddd;}
        
        #lichsu-container {margin-top:20px; border-radius:20px; max-height:600px; overflow-y:auto;}
        .history-card { 
            background: #fff; border: 1px solid #eee; border-radius: 15px; 
            padding: 15px; margin-bottom: 15px; position: relative; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.02); 
        }
        body.dark .history-card { background: #252525; border-color: #333; }
        
        .history-card .date-header { 
            font-weight: bold; font-size: 0.95rem; margin-bottom: 8px; 
            border-bottom: 1px solid #f0f0f0; padding-bottom: 6px; padding-right: 30px; 
        }
        body.dark .history-card .date-header { border-bottom-color: #444; }

        .history-delete { 
            position: absolute; top: 10px; right: 10px; background:#ff3b30; color:white; 
            border:none; border-radius: 50%; width: 24px; height: 24px; 
            cursor:pointer; z-index: 5; display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: bold;
        }

        .history-card .user-line { font-weight: bold; font-size: 0.95rem; color: #142a51; margin-bottom: 4px; }
        body.dark .history-card .user-line { color: #fff; }
        
        .history-card .shift-text { font-size: 0.85rem; font-weight: 700; color: #008000; margin-bottom: 3px; }
        body.dark .history-card .shift-text { color: #00ff00; }
        
        .history-card .info-text { font-size: 0.85rem; margin-bottom: 3px; color: #333; }
        body.dark .history-card .info-text { color: #ccc; }

        .history-card .company-line { 
            font-size: 0.85rem; font-weight: bold; display: flex; align-items: center; gap: 5px; margin-top: 5px; margin-bottom: 10px;
        }
        
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.85rem; color: #555; background: #f9f9f9; padding: 8px; border-radius: 8px; }
        body.dark .details-grid { color: #ccc; background: #333; }
        
        #footer-credit {text-align:center;margin-top:25px;font-size:0.75rem;color:#888; display: flex; align-items: center; justify-content: center; gap: 4px; flex-wrap: wrap;}
        .hidden {display:none !important;}
    </style>
</head>
<body>

<div id="app">
    <button id="themeToggle">üåô</button>
    <h1 data-text="title">GHI CH√âP L∆Ø∆†NG</h1>
    
    <select id="lang-select" style="margin-bottom:15px;">
        <option value="vi">Ti·∫øng Vi·ªát</option>
        <option value="en">English</option>
        <option value="zh">‰∏≠Êñá</option>
    </select>

    <div id="form-ghi">
        <div class="field"><label data-text="label_name">H·ªç v√† T√™n</label><input type="text" id="hoten" placeholder="..."></div>
        <div class="field"><label data-text="label_id">M√£ ID</label><input type="text" id="maid" placeholder="..."></div>
        <div class="field"><label data-text="label_date">Ng√†y</label><input type="date" id="ngay"></div>
        <div class="field">
            <label data-text="label_shift">Ch·ªçn ca l√†m</label>
            <select id="calam">
                <option value="day" data-text-option="shift_day">Ca ng√†y (8h-20h)</option>
                <option value="night" data-text-option="shift_night">Ca ƒë√™m (20h-8h)</option>
            </select>
        </div>
        <div class="field"><label data-text="label_company">T√™n c√¥ng ty</label><input type="text" id="tencongty"></div>
        <div class="field"><label data-text="label_dept">B·ªô ph·∫≠n</label><input type="text" id="bophan" placeholder="..."></div>

        <div class="time-group">
            <div><label data-text="label_start_time_short">V√†o</label>
                <div style="display:flex; gap:4px;"><input type="number" id="gv_h" value="8"> : <input type="number" id="gv_p" value="0"></div>
            </div>
            <div><label data-text="label_end_time_short">Ra</label>
                <div style="display:flex; gap:4px;"><input type="number" id="gr_h" value="17"> : <input type="number" id="gr_p" value="0"></div>
            </div>
        </div>

        <div class="time-group" style="margin-top:10px;">
            <div><label data-text="label_total_hours">T·ªïng gi·ªù</label><input type="text" id="res_tong" readonly></div>
            <div><label data-text="label_overtime">TƒÉng ca</label><input type="text" id="res_tc" readonly></div>
        </div>
        
        <div style="display:flex; justify-content:space-between; margin-top:15px;">
            <button id="btn-save" data-text="btn_save">L∆∞u</button>
            <button id="btn-reset" data-text="btn_reset">Reset</button>
        </div>
        <button id="btn-show-history" data-text="btn_show_history">Xem chi ti·∫øt l·ªãch s·ª≠</button>
    </div>

    <div id="lichsu-container" class="hidden">
        <h2 data-text="history_title" style="text-align:center; font-size: 1.1rem;">L·ªäCH S·ª¨ CHI TI·∫æT</h2>
        <div id="lichsu-list"></div>
        <button id="btn-clear" data-text="btn_clear_history" style="width:100%; background:#ff3b30; color:white; margin-top:10px;">X√≥a l·ªãch s·ª≠</button>
        <button id="btn-back" data-text="btn_back" style="width:100%; background:#4cd964; color:white; margin-top:10px;">Quay l·∫°i</button>
    </div>

    <div id="footer-credit">
        <span data-text="footer_text">M·ªôt s·∫£n ph·∫©m c·ªßa :</span>
        <strong>PH·∫†M VƒÇN H√íA PRIORITY</strong>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.75738 11.7976C7.37538 11.3986 6.74338 11.3826 6.34338 11.7646C5.94438 12.1456 5.92838 12.7786 6.31038 13.1786L9.4665 16.1912C9.6545 16.3882 9.9145 16.5002 10.1865 16.5012H10.1905C10.4615 16.5012 10.7205 16.3912 10.9085 16.1962L17.6855 9.19624C18.0695 8.79924 18.0595 8.16624 17.6625 7.78224C17.2645 7.39724 16.6315 7.40924 16.2485 7.80524L10.1955 14.0582L7.75738 11.7976ZM12.0004 2.00146C6.47738 2.00146 2.00038 6.47846 2.00038 12.0015C2.00038 17.5235 6.47738 22.0015 12.0004 22.0015C17.5234 22.0015 22.0004 17.5235 22.0004 12.0015C22.0004 6.47846 17.5234 2.00146 12.0004 2.00146Z" fill="#00BC3C"></path></svg>
    </div>
</div>

<script>
const texts = {
    vi: { title:"GHI CH√âP L∆Ø∆†NG", label_name:"H·ªç v√† T√™n", label_id:"M√£ ID", label_company:"T√™n c√¥ng ty", label_dept:"B·ªô ph·∫≠n", label_date:"Ng√†y", label_shift:"Ch·ªçn ca l√†m", shift_day:"Ca ng√†y", shift_night:"Ca ƒë√™m", label_start_time_short:"V√†o", label_end_time_short:"Ra", label_total_hours:"T·ªïng gi·ªù", label_overtime:"TƒÉng ca", btn_save:"L∆∞u", btn_reset:"Reset", btn_show_history:"Xem chi ti·∫øt l·ªãch s·ª≠", history_title:"L·ªäCH S·ª¨ CHI TI·∫æT", no_history:"Ch∆∞a c√≥ d·ªØ li·ªáu.", btn_clear_history:"X√≥a l·ªãch s·ª≠", btn_back:"Quay l·∫°i", label_dept_display: "B·ªô ph·∫≠n : ", label_company_display: "T√™n c√¥ng ty : ", footer_text: "M·ªôt s·∫£n ph·∫©m c·ªßa :" },
    en: { title:"WORK LOG", label_name:"Full Name", label_id:"ID Code", label_company:"Company", label_dept:"Dept", label_date:"Date", label_shift:"Shift", shift_day:"Day Shift", shift_night:"Night Shift", label_start_time_short:"In", label_end_time_short:"Out", label_total_hours:"Total", label_overtime:"OT", btn_save:"Save", btn_reset:"Reset", btn_show_history:"View History", history_title:"HISTORY", no_history:"No data.", btn_clear_history:"Clear All", btn_back:"Back", label_dept_display: "Dept : ", label_company_display: "Company : ", footer_text: "A product of :" },
    zh: { title:"Â∑•ËµÑËÆ∞ÂΩï", label_name:"ÂßìÂêç", label_id:"Â∑•Âè∑", label_company:"ÂÖ¨Âè∏", label_dept:"ÈÉ®Èó®", label_date:"Êó•Êúü", label_shift:"Áè≠Ê¨°", shift_day:"ÁôΩÁè≠", shift_night:"Â§úÁè≠", label_start_time_short:"ÂÖ•", label_end_time_short:"Âá∫", label_total_hours:"Â∑•Êó∂", label_overtime:"Âä†Áè≠", btn_save:"‰øùÂ≠ò", btn_reset:"ÈáçÁΩÆ", btn_show_history:"ÂéÜÂè≤", history_title:"ÂéÜÂè≤ËØ¶ÊÉÖ", no_history:"Êó†Êï∞ÊçÆ", btn_clear_history:"Ê∏ÖÈô§", btn_back:"ËøîÂõû", label_dept_display: "ÈÉ®Èó® : ", label_company_display: "ÂÖ¨Âè∏ : ", footer_text: "‰∫ßÂìÅÊù•Ëá™ :" }
};

let currentLang = 'vi';
let lichSu = JSON.parse(localStorage.getItem("lichSuLuong_V4") || "[]");

const checkIcon = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="flex-shrink:0;"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.75738 11.7976C7.37538 11.3986 6.74338 11.3826 6.34338 11.7646C5.94438 12.1456 5.92838 12.7786 6.31038 13.1786L9.4665 16.1912C9.6545 16.3882 9.9145 16.5002 10.1865 16.5012H10.1905C10.4615 16.5012 10.7205 16.3912 10.9085 16.1962L17.6855 9.19624C18.0695 8.79924 18.0595 8.16624 17.6625 7.78224C17.2645 7.39724 16.6315 7.40924 16.2485 7.80524L10.1955 14.0582L7.75738 11.7976ZM12.0004 2.00146C6.47738 2.00146 2.00038 6.47846 2.00038 12.0015C2.00038 17.5235 6.47738 22.0015 12.0004 22.0015C17.5234 22.0015 22.0004 17.5235 22.0004 12.0015C22.0004 6.47846 17.5234 2.00146 12.0004 2.00146Z" fill="#00BC3C"></path></svg>`;

window.onload = function() {
    document.getElementById('hoten').value = localStorage.getItem("user_name") || "";
    document.getElementById('maid').value = localStorage.getItem("user_id") || "";
    document.getElementById('ngay').valueAsDate = new Date();
    calculate();
};

function calculate() {
    let v_h = parseInt(document.getElementById('gv_h').value) || 0;
    let v_p = parseInt(document.getElementById('gv_p').value) || 0;
    let r_h = parseInt(document.getElementById('gr_h').value) || 0;
    let r_p = parseInt(document.getElementById('gr_p').value) || 0;
    let totalMin = (r_h * 60 + r_p) - (v_h * 60 + v_p);
    if (totalMin < 0) totalMin += 1440;
    let totalHours = totalMin / 60;
    let tc = totalHours > 9 ? totalHours - 9 : 0;
    if (totalHours <= 9 && totalHours > 8) tc = 0;
    document.getElementById('res_tong').value = totalHours.toFixed(2) + "h";
    document.getElementById('res_tc').value = tc.toFixed(2) + "h";
}

function renderHistory() {
    const box = document.getElementById('lichsu-list');
    box.innerHTML = "";
    if(lichSu.length === 0) {
        box.innerHTML = `<p style="text-align:center; color:#888; padding:20px;">${texts[currentLang].no_history}</p>`;
        return;
    }
    const t = texts[currentLang];
    [...lichSu].reverse().forEach((item, index) => {
        const originalIndex = lichSu.length - 1 - index;
        const card = document.createElement('div');
        card.className = "history-card";
        const caText = item.calam === "day" ? t.shift_day : t.shift_night;
        
        card.innerHTML = `
            <button class="history-delete" onclick="deleteItem(${originalIndex})">‚úñ</button>
            <div class="date-header">${item.ngay}</div>
            <div class="user-line">${item.hoten} | ID: ${item.maid || '...'}</div>
            <div class="shift-text">${caText}</div>
            <div class="info-text">${t.label_dept_display}${item.bophan || '...'}</div>
            <div class="company-line">
                <span>${t.label_company_display}${item.tencongty}</span>
                ${checkIcon}
            </div>
            <div class="details-grid">
                <span>${t.label_start_time_short}: ${item.giovao}</span>
                <span>${t.label_total_hours}: ${item.tong}</span>
                <span>${t.label_end_time_short}: ${item.giora}</span>
                <span>${t.label_overtime}: ${item.tc}</span>
            </div>
        `;
        box.appendChild(card);
    });
}

document.getElementById('btn-save').onclick = function() {
    const hoten = document.getElementById('hoten').value;
    const maid = document.getElementById('maid').value;
    const cty = document.getElementById('tencongty').value;
    const bophan = document.getElementById('bophan').value;
    const ngay = document.getElementById('ngay').value;
    if(!cty || !ngay || !hoten) { alert("Vui l√≤ng nh·∫≠p ƒë·ªß T√™n, Ng√†y v√† C√¥ng ty!"); return; }
    localStorage.setItem("user_name", hoten);
    localStorage.setItem("user_id", maid);
    lichSu.push({
        hoten, maid, ngay, tencongty: cty, bophan,
        giovao: document.getElementById('gv_h').value + ":" + document.getElementById('gv_p').value.toString().padStart(2,'0'),
        giora: document.getElementById('gr_h').value + ":" + document.getElementById('gr_p').value.toString().padStart(2,'0'),
        tong: document.getElementById('res_tong').value,
        tc: document.getElementById('res_tc').value,
        calam: document.getElementById('calam').value
    });
    localStorage.setItem("lichSuLuong_V4", JSON.stringify(lichSu));
    alert("ƒê√£ l∆∞u th√†nh c√¥ng!");
};

window.deleteItem = (i) => { if(confirm("X√≥a d√≤ng n√†y?")) { lichSu.splice(i,1); localStorage.setItem("lichSuLuong_V4", JSON.stringify(lichSu)); renderHistory(); }};

document.getElementById('lang-select').onchange = function() {
    currentLang = this.value;
    document.querySelectorAll("[data-text]").forEach(el => {
        const key = el.getAttribute("data-text");
        if(texts[currentLang][key]) el.textContent = texts[currentLang][key];
    });
    const calamSelect = document.getElementById('calam');
    calamSelect.options[0].textContent = texts[currentLang].shift_day + " (8h-20h)";
    calamSelect.options[1].textContent = texts[currentLang].shift_night + " (20h-8h)";
    renderHistory();
};

document.getElementById('themeToggle').onclick = function() {
    document.body.classList.toggle('dark');
    this.innerText = document.body.classList.contains('dark') ? "‚òÄÔ∏è" : "üåô";
};

document.getElementById('btn-show-history').onclick = function() {
    document.getElementById('form-ghi').classList.add('hidden');
    document.getElementById('lichsu-container').classList.remove('hidden');
    renderHistory();
};

document.getElementById('btn-back').onclick = function() {
    document.getElementById('form-ghi').classList.remove('hidden');
    document.getElementById('lichsu-container').classList.add('hidden');
};

document.getElementById('btn-reset').onclick = () => { 
    document.getElementById('hoten').value = ""; 
    document.getElementById('maid').value = ""; 
    document.getElementById('tencongty').value = ""; 
    document.getElementById('bophan').value = ""; 
    document.getElementById('ngay').valueAsDate = new Date();
    document.getElementById('gv_h').value = 8;
    document.getElementById('gv_p').value = 0;
    document.getElementById('gr_h').value = 17;
    document.getElementById('gr_p').value = 0;
    document.getElementById('calam').value = "day";
    calculate(); 
};

document.getElementById('btn-clear').onclick = () => { if(confirm("X√≥a to√†n b·ªô l·ªãch s·ª≠?")) { lichSu=[]; localStorage.removeItem("lichSuLuong_V4"); renderHistory(); }};

["gv_h", "gv_p", "gr_h", "gr_p"].forEach(id => {
    document.getElementById(id).addEventListener("input", calculate);
});

document.getElementById('calam').onchange = function() {
    if(this.value === 'day') {
        document.getElementById('gv_h').value = 8;
        document.getElementById('gr_h').value = 17;
    } else {
        document.getElementById('gv_h').value = 20;
        document.getElementById('gr_h').value = 5;
    }
    calculate();
};
</script>
</body>
</html>
