
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>C√îNG C·ª§ GHI CH√âP NG√ÄY GI·ªú ƒêI L√ÄM</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Text:wght@400;700&display=swap');
        
        body {margin:0;padding:0;font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;background: linear-gradient(135deg,#f0f0f5 0%,#d9d9d9 100%);display:flex;justify-content:center;align-items:flex-start;padding:20px;-webkit-font-smoothing:antialiased; transition: background 0.3s;}
        body.dark { background: #1a1a1a; color: #eee; }
        
        #app {background: rgba(255 255 255 / 0.85);backdrop-filter: saturate(180%) blur(20px);border-radius: 20px;box-shadow: 0 8px 32px 0 rgba(0,0,0,0.12);padding:40px 28px 28px 28px;max-width:420px;width:100%;color:#142a51;box-sizing:border-box; position: relative;}
        body.dark #app { background: rgba(40, 40, 40, 0.95); color: #fff; }
        
        #themeToggle { position: absolute; top: 15px; right: 15px; border: none; background: rgba(0,0,0,0.05); width: 35px; height: 35px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        body.dark #themeToggle { background: rgba(255,255,255,0.1); }
        
        h1 {margin:0 0 10px 0;font-weight:700;font-size:1.4rem;text-align:center; text-transform: uppercase;}
        .field {margin-bottom:12px;}
        label {display:block;margin-bottom:4px;font-weight:600;font-size:0.85rem;}
        
        input[type="text"], input[type="date"], input[type="number"], select {width:100%;padding:10px 14px;font-size:1rem;border:1px solid #ddd;border-radius:12px;background: #fff;box-sizing:border-box; outline: none;}
        body.dark input, body.dark select { background: #333; color: #fff; border-color: #444; }
        input:focus { border-color: #4cd964; }
        
        .time-group {display:flex;gap:8px;}
        .time-group > div {flex:1;}
        
        button {cursor:pointer;font-weight:700;font-size:1rem;border:none;border-radius:12px;padding:12px 0;width:48%; transition: 0.3s;}
        #btn-save {background-color:#4cd964;color:white;}
        #btn-reset {background-color:#ff3b30;color:white;}
        #btn-show-history {background-color:#fff;color:#142a51;border-radius:16px;padding:12px 0;width:100%;margin-top:12px;font-weight:700;box-shadow:0 2px 8px rgb(0 0 0 / 0.12); border: 1px solid #ddd;}
        
        #lichsu-container {margin-top:20px; border-radius:20px; max-height:500px; overflow-y:auto;}
        .history-card { 
            background: #fff; 
            border: 1px solid #eee; 
            border-radius: 15px; 
            padding: 15px; 
            margin-bottom: 15px; 
            position: relative; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.02); 
        }
        body.dark .history-card { background: #252525; border-color: #333; }
        
        .history-card .date-header { 
            font-weight: bold; 
            font-size: 0.95rem; 
            margin-bottom: 4px; 
            border-bottom: 1px solid #f0f0f0; 
            padding-bottom: 4px;
            padding-right: 30px; /* Ch·ª´a ch·ªó cho n√∫t X s√°t m√©p */
        }
        body.dark .history-card .date-header { border-bottom-color: #444; }

        .history-delete { 
            position: absolute; 
            top: 10px; /* N·∫±m s√°t m√©p tr√™n */
            right: 10px; /* N·∫±m s√°t m√©p ph·∫£i */
            background:#ff3b30; 
            color:white; 
            border:none; 
            border-radius: 50%; /* Bo tr√≤n ho√†n to√†n */
            width: 24px; 
            height: 24px; 
            cursor:pointer;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .history-card .shift-tag { font-weight: bold; color: #28a745; font-size: 0.85rem; display: block; margin-bottom: 5px; }
        .history-card .company { font-weight: bold; margin-bottom: 8px; font-size: 0.9rem; color: #142a51; }
        body.dark .history-card .company { color: #81b0ff; }
        
        .history-card .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.85rem; color: #555; }
        body.dark .history-card .details-grid { color: #ccc; }
        
        #footer-credit {text-align:center;margin-top:20px;font-size:0.75rem;color:#888;display:flex;align-items:center;justify-content:center;gap:6px;}
        .hidden {display:none !important;}
    </style>
</head>
<body>

<div id="app">
    <button id="themeToggle">üåô</button>
    <h1 data-text="title">GHI CH√âP L∆Ø∆†NG</h1>
    
    <select id="lang-select" style="margin-bottom:15px;">
        <option value="vi">Ti·∫øng Vi·ªát</option>
        <option value="en">English</option>
        <option value="zh">‰∏≠Êñá</option>
    </select>

    <div id="form-ghi">
        <div class="field"><label data-text="label_date">Ng√†y</label><input type="date" id="ngay"></div>
        <div class="field">
            <label data-text="label_shift">Ch·ªçn ca l√†m</label>
            <select id="calam">
                <option value="day" data-text-option="shift_day">Ca ng√†y (8h-20h)</option>
                <option value="night" data-text-option="shift_night">Ca ƒë√™m (20h-8h)</option>
            </select>
        </div>
        <div class="field"><label data-text="label_company">T√™n c√¥ng ty</label><input type="text" id="tencongty"></div>

        <div class="time-group">
            <div><label data-text="label_start_time_short">V√†o (Gi·ªù : Ph√∫t)</label>
                <div style="display:flex; gap:4px;"><input type="number" id="gv_h" value="8"> : <input type="number" id="gv_p" value="0"></div>
            </div>
            <div><label data-text="label_end_time_short">Ra (Gi·ªù : Ph√∫t)</label>
                <div style="display:flex; gap:4px;"><input type="number" id="gr_h" value="17"> : <input type="number" id="gr_p" value="0"></div>
            </div>
        </div>

        <div class="time-group" style="margin-top:10px;">
            <div><label data-text="label_total_hours">T·ªïng gi·ªù</label><input type="text" id="res_tong" readonly></div>
            <div><label data-text="label_overtime">TƒÉng ca</label><input type="text" id="res_tc" readonly></div>
        </div>
        
        <div style="display:flex; justify-content:space-between; margin-top:15px;">
            <button id="btn-save" data-text="btn_save">L∆∞u</button>
            <button id="btn-reset" data-text="btn_reset">Reset</button>
        </div>
        <button id="btn-show-history" data-text="btn_show_history">Xem chi ti·∫øt l·ªãch s·ª≠</button>
    </div>

    <div id="lichsu-container" class="hidden">
        <h2 data-text="history_title" style="text-align:center; font-size: 1.1rem;">L·ªäCH S·ª¨ CHI TI·∫æT</h2>
        <div id="lichsu-list"></div>
        <button id="btn-clear" data-text="btn_clear_history" style="width:100%; background:#ff3b30; color:white; margin-top:10px;">X√≥a l·ªãch s·ª≠</button>
        <button id="btn-back" data-text="btn_back" style="width:100%; background:#4cd964; color:white; margin-top:10px;">Quay l·∫°i</button>
    </div>

    <div id="footer-credit">
        <span>M·ªôt s·∫£n ph·∫©m c·ªßa : PH·∫†M VƒÇN H√íA PRIORITY</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#4cd964"/></svg>
    </div>
</div>

<script>
const texts = {
    vi: { title:"GHI CH√âP L∆Ø∆†NG", label_company:"T√™n c√¥ng ty", label_date:"Ng√†y", label_shift:"Ch·ªçn ca l√†m", shift_day:"Ca ng√†y (8h-20h)", shift_night:"Ca ƒë√™m (20h-8h)", label_start_time_short:"V√†o", label_end_time_short:"Ra", label_total_hours:"T·ªïng gi·ªù", label_overtime:"TƒÉng ca", btn_save:"L∆∞u", btn_reset:"Reset", btn_show_history:"Xem chi ti·∫øt l·ªãch s·ª≠", history_title:"L·ªäCH S·ª¨ CHI TI·∫æT", no_history:"Ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠.", btn_clear_history:"X√≥a l·ªãch s·ª≠", btn_back:"Quay l·∫°i" },
    en: { title:"WORK LOG", label_company:"Company Name", label_date:"Date", label_shift:"Select Shift", shift_day:"Day Shift (8h-20h)", shift_night:"Night Shift (20h-8h)", label_start_time_short:"In", label_end_time_short:"Out", label_total_hours:"Total Hours", label_overtime:"Overtime", btn_save:"Save", btn_reset:"Reset", btn_show_history:"View History", history_title:"DETAILED HISTORY", no_history:"No data.", btn_clear_history:"Clear All", btn_back:"Back" },
    zh: { title:"Â∑•ËµÑËÆ∞ÂΩï", label_company:"ÂÖ¨Âè∏ÂêçÁß∞", label_date:"Êó•Êúü", label_shift:"ÈÄâÊã©Áè≠Ê¨°", shift_day:"ÁôΩÁè≠ (8h-20h)", shift_night:"Â§úÁè≠ (20h-8h)", label_start_time_short:"ËøõÂÖ•", label_end_time_short:"Âá∫Âéª", label_total_hours:"ÊÄªÂ∑•Êó∂", label_overtime:"Âä†Áè≠", btn_save:"‰øùÂ≠ò", btn_reset:"ÈáçÁΩÆ", btn_show_history:"Êü•ÁúãÂéÜÂè≤", history_title:"ÂéÜÂè≤ËØ¶ÊÉÖ", no_history:"ÊöÇÊó†Êï∞ÊçÆ„ÄÇ", btn_clear_history:"Ê∏ÖÈô§ÂÖ®ÈÉ®", btn_back:"ËøîÂõû" }
};

let currentLang = 'vi';
let lichSu = JSON.parse(localStorage.getItem("lichSuLuong_V4") || "[]");

function calculate() {
    let v_h = parseInt(document.getElementById('gv_h').value) || 0;
    let v_p = parseInt(document.getElementById('gv_p').value) || 0;
    let r_h = parseInt(document.getElementById('gr_h').value) || 0;
    let r_p = parseInt(document.getElementById('gr_p').value) || 0;

    let totalMin = (r_h * 60 + r_p) - (v_h * 60 + v_p);
    if (totalMin < 0) totalMin += 24 * 60;

    let totalHours = totalMin / 60;
    let tc = totalHours > 9 ? totalHours - 9 : 0; 
    if (totalHours <= 9 && totalHours > 8) tc = 0; 

    document.getElementById('res_tong').value = totalHours.toFixed(2) + "h";
    document.getElementById('res_tc').value = tc.toFixed(2) + "h";
}

document.getElementById('calam').onchange = function() {
    if(this.value === 'day') {
        document.getElementById('gv_h').value = 8;
        document.getElementById('gr_h').value = 17;
    } else {
        document.getElementById('gv_h').value = 20;
        document.getElementById('gr_h').value = 5;
    }
    calculate();
};

function renderHistory() {
    const box = document.getElementById('lichsu-list');
    box.innerHTML = "";
    if(lichSu.length === 0) {
        box.innerHTML = `<p style="text-align:center; color:#888; padding:20px;">${texts[currentLang].no_history}</p>`;
        return;
    }
    [...lichSu].reverse().forEach((item, index) => {
        const originalIndex = lichSu.length - 1 - index;
        const card = document.createElement('div');
        card.className = "history-card";
        // L·∫•y nh√£n ca l√†m t·ª´ b·ªô ng√¥n ng·ªØ hi·ªán t·∫°i
        const caText = item.calam === "day" ? texts[currentLang].shift_day.split(' (')[0] : texts[currentLang].shift_night.split(' (')[0];
        card.innerHTML = `
            <button class="history-delete" onclick="deleteItem(${originalIndex})">‚úñ</button>
            <div class="date-header">${texts[currentLang].label_date}: ${item.ngay}</div>
            <span class="shift-tag">${caText}</span>
            <div class="company">${texts[currentLang].label_company}: ${item.tencongty}</div>
            <div class="details-grid">
                <span>${texts[currentLang].label_start_time_short}: ${item.giovao}</span>
                <span>${texts[currentLang].label_total_hours}: ${item.tong}</span>
                <span>${texts[currentLang].label_end_time_short}: ${item.giora}</span>
                <span>${texts[currentLang].label_overtime}: ${item.tc}</span>
            </div>
        `;
        box.appendChild(card);
    });
}

document.getElementById('btn-save').onclick = function() {
    const cty = document.getElementById('tencongty').value;
    const ngay = document.getElementById('ngay').value;
    if(!cty || !ngay) { alert("Nh·∫≠p ƒë·ªß th√¥ng tin!"); return; }
    
    lichSu.push({
        ngay: ngay, tencongty: cty,
        giovao: document.getElementById('gv_h').value + ":" + document.getElementById('gv_p').value.padStart(2,'0'),
        giora: document.getElementById('gr_h').value + ":" + document.getElementById('gr_p').value.padStart(2,'0'),
        tong: document.getElementById('res_tong').value,
        tc: document.getElementById('res_tc').value,
        calam: document.getElementById('calam').value
    });
    localStorage.setItem("lichSuLuong_V4", JSON.stringify(lichSu));
    alert("ƒê√£ l∆∞u!");
};

window.deleteItem = (i) => { if(confirm("X√≥a?")) { lichSu.splice(i,1); localStorage.setItem("lichSuLuong_V4", JSON.stringify(lichSu)); renderHistory(); }};

document.getElementById('lang-select').onchange = function() {
    currentLang = this.value;
    
    // C·∫≠p nh·∫≠t c√°c vƒÉn b·∫£n th√¥ng th∆∞·ªùng
    document.querySelectorAll("[data-text]").forEach(el => {
        const key = el.getAttribute("data-text");
        if(texts[currentLang][key]) el.textContent = texts[currentLang][key];
    });

    // C·∫≠p nh·∫≠t vƒÉn b·∫£n trong Select Ca l√†m
    const calamSelect = document.getElementById('calam');
    calamSelect.options[0].textContent = texts[currentLang].shift_day;
    calamSelect.options[1].textContent = texts[currentLang].shift_night;

    renderHistory();
};

document.getElementById('themeToggle').onclick = function() {
    document.body.classList.toggle('dark');
    this.innerText = document.body.classList.contains('dark') ? "‚òÄÔ∏è" : "üåô";
};

document.getElementById('btn-show-history').onclick = function() {
    document.getElementById('form-ghi').classList.add('hidden');
    document.getElementById('lichsu-container').classList.remove('hidden');
    renderHistory();
};

document.getElementById('btn-back').onclick = function() {
    document.getElementById('form-ghi').classList.remove('hidden');
    document.getElementById('lichsu-container').classList.add('hidden');
};

document.getElementById('btn-reset').onclick = () => { document.getElementById('tencongty').value = ""; calculate(); };
document.getElementById('btn-clear').onclick = () => { if(confirm("X√≥a h·∫øt?")) { lichSu=[]; localStorage.removeItem("lichSuLuong_V4"); renderHistory(); }};

["gv_h", "gv_p", "gr_h", "gr_p"].forEach(id => {
    document.getElementById(id).addEventListener("input", calculate);
});

document.getElementById('ngay').valueAsDate = new Date();
calculate();
</script>
</body>
</html>
